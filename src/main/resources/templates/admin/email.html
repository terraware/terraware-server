<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">

<body>
<span th:replace="~{/admin/header :: top}"/>
<a href="/admin/">Home</a>

<h2>Send Test Email</h2>

<form method="POST" action="/admin/sendEmail" th:if="${isEmailEnabled}">
    <label for="recipient">Recipient</label>
    <input type="email" name="recipient" id="recipient" required/>
    <input type="checkbox" id="sendToAll" name="sendToAll">
    <label for="sendToAll"> Send to all users</label>
    <br/>
    <label for="emailName">Email to Send</label>
    <select name="emailName" id="emailName">
        <option th:value="DocumentsUpdate">Documents Update (EULA, TOS, Privacy update)</option>
        <option th:value="GenericEmail">Generic Email</option>
    </select>
    <br/>
    <div id="genericEmailFields" style="display: none;">
        <label for="subject">Subject</label>
        <input type="text" name="subject" id="subject"/>
        <br/>
        <label for="emailBody">Email Body</label>
        <textarea name="emailBody" id="emailBody" rows="10" cols="50"></textarea>
        <br/>
    </div>
    <input type="submit" value=" Send Test Email "/>
</form>

<div th:if="${!isEmailEnabled}">
    <h3>The system is not configured to send emails.</h3>
</div>

<script>
    const sendToAllCheckbox = document.getElementById('sendToAll');
    const recipientInput = document.getElementById('recipient');
    const emailNameSelect = document.getElementById('emailName');
    const genericEmailFields = document.getElementById('genericEmailFields');

    sendToAllCheckbox.addEventListener('change', function () {
        if (sendToAllCheckbox.checked) {
            recipientInput.removeAttribute('required');
            recipientInput.disabled = true;
        } else {
            recipientInput.setAttribute('required', true);
            recipientInput.disabled = false;
        }
    });

    emailNameSelect.addEventListener('change', function () {
        if (emailNameSelect.value === 'GenericEmail') {
            genericEmailFields.style.display = 'block';
        } else {
            genericEmailFields.style.display = 'none';
        }
    });
</script>
</body>
</html>
