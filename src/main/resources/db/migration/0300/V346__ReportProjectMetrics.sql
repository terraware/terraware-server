CREATE TABLE accelerator.project_metrics(
    id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    project_id BIGINT NOT NULL REFERENCES projects ON DELETE CASCADE,
    type_id INTEGER NOT NULL REFERENCES accelerator.metric_types,
    component_id INTEGER NOT NULL REFERENCES accelerator.metric_components,
    name TEXT NOT NULL,
    description TEXT,
    reference TEXT NOT NULL
);
CREATE INDEX ON accelerator.project_metrics(project_id);

CREATE TABLE accelerator.report_project_metrics(
    report_id BIGINT NOT NULL REFERENCES accelerator.reports ON DELETE CASCADE,
    project_id BIGINT NOT NULL REFERENCES projects ON DELETE CASCADE,
    project_metric_id BIGINT NOT NULL REFERENCES accelerator.project_metrics,
    target INTEGER,
    value INTEGER,
    notes TEXT,
    internal_comment TEXT,
    modified_by BIGINT NOT NULL REFERENCES users,
    modified_time TIMESTAMP WITH TIME ZONE NOT NULL,

    FOREIGN KEY (report_id, project_id) REFERENCES accelerator.reports(id, project_id),
    FOREIGN KEY (project_id, project_metric_id) REFERENCES accelerator.project_metrics(project_id, id),

    PRIMARY KEY (report_id, project_id, project_metric_id)
);
