<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<configuration xmlns="http://www.jooq.org/xsd/jooq-codegen-3.14.0.xsd">
  <jdbc>
    <driver>org.postgresql.Driver</driver>
    <url>jdbc:postgresql://localhost:15432/seedbank-build</url>
    <user>seedbank</user>
    <password>seedbank</password>
  </jdbc>
  <generator>
    <name>com.terraformation.seedbank.jooq.EnumGenerator</name>

    <database>
      <name>org.jooq.meta.postgres.PostgresDatabase</name>
      <includes>.*</includes>
      <!-- The excludes list should contain all the tables in EnumGenerator.kt. -->
      <excludes>
        flyway_.*
        | accession_state$
        | germination_seed_type$
        | germination_substrate$
        | germination_test_type$
        | germination_treatment$
        | notification_type$
        | processing_method$
        | storage_condition$
        | timeseries_type$
        | withdrawal_purpose$
      </excludes>

      <inputSchema>public</inputSchema>

      <forcedTypes>
        <!-- Use java.time.Instant for timestamps -->
        <forcedType>
          <name>INSTANT</name>
          <includeTypes>(?i:TIMESTAMP\ WITH\ TIME\ ZONE)</includeTypes>
        </forcedType>

        <!-- Use enum classes rather than numeric IDs for foreign keys to reference tables.
             This list must match the table list in EnumGenerator.kt in the buildSrc directory. -->
        <forcedType>
          <userType>com.terraformation.seedbank.db.AccessionState</userType>
          <converter>com.terraformation.seedbank.db.AccessionStateConverter</converter>
          <includeTypes>INTEGER</includeTypes>
          <!-- Regex matches both accession.state_id and notification.accession_state_id -->
          <includeExpression>(?i:accession.state_id)</includeExpression>
        </forcedType>

        <forcedType>
          <userType>com.terraformation.seedbank.db.GerminationSeedType</userType>
          <converter>com.terraformation.seedbank.db.GerminationSeedTypeConverter</converter>
          <includeTypes>INTEGER</includeTypes>
          <includeExpression>(?i:germination_test\.seed_type_id)</includeExpression>
        </forcedType>

        <forcedType>
          <userType>com.terraformation.seedbank.db.GerminationSubstrate</userType>
          <converter>com.terraformation.seedbank.db.GerminationSubstrateConverter</converter>
          <includeTypes>INTEGER</includeTypes>
          <includeExpression>(?i:germination_test\.substrate_id)</includeExpression>
        </forcedType>

        <forcedType>
          <userType>com.terraformation.seedbank.db.GerminationTestType</userType>
          <converter>com.terraformation.seedbank.db.GerminationTestTypeConverter</converter>
          <includeTypes>INTEGER</includeTypes>
          <includeExpression>(?i:germination_test\.test_type)</includeExpression>
        </forcedType>

        <forcedType>
          <userType>com.terraformation.seedbank.db.GerminationTreatment</userType>
          <converter>com.terraformation.seedbank.db.GerminationTreatmentConverter</converter>
          <includeTypes>INTEGER</includeTypes>
          <includeExpression>(?i:germination_test\.treatment_id)</includeExpression>
        </forcedType>

        <forcedType>
          <userType>com.terraformation.seedbank.db.NotificationType</userType>
          <converter>com.terraformation.seedbank.db.NotificationTypeConverter</converter>
          <includeTypes>INTEGER</includeTypes>
          <includeExpression>(?i:notification\.type_id)</includeExpression>
        </forcedType>

        <forcedType>
          <userType>com.terraformation.seedbank.db.ProcessingMethod</userType>
          <converter>com.terraformation.seedbank.db.ProcessingMethodConverter</converter>
          <includeTypes>INTEGER</includeTypes>
          <includeExpression>(?i:accession.processing_method_id)</includeExpression>
        </forcedType>

        <forcedType>
          <userType>com.terraformation.seedbank.db.StorageCondition</userType>
          <converter>com.terraformation.seedbank.db.StorageConditionConverter</converter>
          <includeTypes>INTEGER</includeTypes>
          <includeExpression>(?i:(accession\.target_storage_condition|storage_location\.condition_id))</includeExpression>
        </forcedType>

        <forcedType>
          <userType>com.terraformation.seedbank.db.TimeseriesType</userType>
          <converter>com.terraformation.seedbank.db.TimeseriesTypeConverter</converter>
          <includeTypes>INTEGER</includeTypes>
          <includeExpression>(?i:timeseries\.type_id)</includeExpression>
        </forcedType>

        <forcedType>
          <userType>com.terraformation.seedbank.db.WithdrawalPurpose</userType>
          <converter>com.terraformation.seedbank.db.WithdrawalPurposeConverter</converter>
          <includeTypes>INTEGER</includeTypes>
          <includeExpression>(?i:withdrawal\.purpose_id)</includeExpression>
        </forcedType>
      </forcedTypes>
    </database>

    <generate>
      <daos>true</daos>
      <javaTimeTypes>true</javaTimeTypes>
      <pojos>true</pojos>
      <pojosAsKotlinDataClasses>true</pojosAsKotlinDataClasses>
      <records>true</records>
    </generate>

    <target>
      <directory>$projectDir/src/generated/jooq</directory>
      <packageName>com.terraformation.seedbank.db</packageName>
    </target>
  </generator>
</configuration>
